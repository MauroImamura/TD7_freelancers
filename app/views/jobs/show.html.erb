<div><h1>Informações do projeto:</h1></div>

<% if @job.Finalizado? %>
    <% if user_signed_in? && @job.user == current_user %>
        <div><p style="background-color: darkkhaki; font-size: 20px; text-align: center; color: black">Projeto finalizado! Avalie as pessoas que trabalharam no projeto clicando em seus nomes na lista de propostas.</p></div>
    <% elsif worker_signed_in? %>
        <% @job.applications.each do |applies| %>
            <% if current_worker == applies.worker %>
                <div><p>Projeto finalizado! <%= link_to 'Avalie o contratante clicando aqui', new_job_user_feedback_path(@job) %>.</p></div>
            <% end %>
        <% end %>
    <% end %>
<% elsif @job.Contratando? %>
    <% if worker_signed_in? %>
        <% @job.applications.each do |applies| %>
            <% if current_worker == applies.worker %>
                <div><p>Você já enviou uma proposta! <%= link_to 'Clique aqui para cancelar', application_path(applies), method: :delete %>.</p></div>
            <% end %>
        <% end %>
    <% end %>
<% end %>

<div>
    <p>Título: <%= @job.title %></p>
    <p>Contratante: <%= @job.user.email %></p>
    <p>Descrição: <%= @job.description %></p>
    <p>Habilidades exigidas: <%= @job.skills %></p>
    <p>Pagamento por hora: <%= number_to_currency(@job.payment) %></p>
    <p>Data limite para proposta: <%= l @job.deadline, format: :simple %></p>
    <% if @job.in_person? %>
        <p>Trabalho presencial</p>
    <% else %>
        <p>Trabalho remoto</p>
    <% end %>
    <p>Situação: <%= @job.status %></p>
</div>

<% if user_signed_in? && @job.user == current_user %>
    <div id="team_list">
        <h3>Veja o time de profissionais: clique em seus nomes para visualizar o perfil completo</h3>
        <% @job.applications.each do |applies| %>
            <% if applies.Aceita? %>
                <p><%= link_to applies.worker.social_name, worker_path(applies.worker) %></p>
            <% end %>
        <% end %>
    </div>
<% end %>
<% if worker_signed_in? %>
    <% @job.applications.each do |applies| %>
        <% if applies.Aceita? && current_worker == applies.worker %>
            <div id="team_list">
            <h2>Veja o time de profissionais:</h2>
            <% @job.applications.each do |applies| %>
                <% if applies.Aceita? %>
                <p><%= link_to applies.worker.social_name, worker_path(applies.worker) %></p>
                <% end %>
            <% end %>
            </div>
        <% end %>
    <% end %>
<% end %>

<% if worker_signed_in? && @application != nil && @job.Contratando? %>
    <div>
        <% if @application.errors.any? %>
            <ul>
                <% @application.errors.full_messages.each do |error| %>
                    <li><%= error %></li>
                <% end %>
            </ul>
        <% end %>
    </div>
    <div>
        <% if current_worker.social_name.present? && current_worker.full_name.present? && current_worker.birth_date.present? && current_worker.description.present? && current_worker.education.present? && current_worker.experience.present? %>
            <h2>Envie sua proposta</h2>
            <%= form_with model: @application, url: job_applications_path(@job) do |f| %>
                <div>
                    <p><%= f.label :description, 'Conte sua experiência sobre o assunto' %></p>
                    <%= f.text_field :description %>
                </div>
                <div>
                    <p><%= f.label :time_per_week, 'Horas de trabalho semanais' %></p>
                    <%= f.text_field :time_per_week %>
                </div>
                <div>
                    <p><%= f.label :payment, 'Valor por hora de trabalho' %></p>
                    <%= f.text_field :payment %>
                </div>
                <div>
                    <p><%= f.label :expected_deadline, 'Previsão de entrega' %></p>
                    <%= f.date_field :expected_deadline %>
                </div>
                <div>
                    <%= f.submit 'Enviar' %>
                </div>
            <% end %>
        <% else %>
            <p>Complete seu perfil para enviar propostas: <%= link_to 'completar perfil.', edit_worker_path(current_worker) %></p>
        <% end %>
    </div>
<% end %>

<% if user_signed_in? && @job.user == current_user %>
    <div id="job_applications">
        <h3>Todas as propostas:</h3>
        <% @job.applications.each do |applies| %>
            <% if @job.Finalizado? && applies.Aceita? %>
                <p>Proposta de: <%= link_to applies.worker.social_name, new_application_worker_feedback_path(applies) %></p>
            <% elsif %>
                <p>Proposta de: <%= applies.worker.social_name %></p>
            <% end %>
            <dl>
                <dt>Experiências: <%= applies.description %></dt><dd></dd>
                <dt>Valor da hora trabalhada: <%= number_to_currency(applies.payment) %></dt><dd></dd>
                <dt>Dedicação semanal: <%= applies.time_per_week %> horas</dt><dd></dd>
                <dt>Prazo de entrega estimado: <%= l applies.expected_deadline, format: :simple %></dt><dd></dd>
                <dt>Situação: <%= applies.status %></dt>
            </dl>
            <% if applies.Pendente? %>
                <%= link_to 'Aceitar proposta', accept_application_path(applies.id), method: :post %>
                <%= link_to 'Recusar proposta', refuse_application_path(applies.id), method: :post %>
            <% end %>
        <% end %>
        <% if @job.Contratando? %>
            <%= link_to 'Encerrar contratações', finish_hiring_job_path(@job.id), method: :post %>
        <% elsif @job.Executando? %>
            <%= link_to 'Finalizar projeto', finish_project_job_path(@job.id), method: :post %>
        <% end %>
    </div>
<% end %>
<div>
    <%= link_to 'Ver todos os projeto', job_list_path %>
</div>